//CHECKSUM:2fda37740e83d445382fcb93360e5f76158669b828f32b2b3e3350be6452cf6f
{"version":3,"sources":["../content-types/carousel.js"],"names":["base","require","Card","url","render","data","events","typing","push","type","value","text","elements","items","map","card","title","picture","image","resolve","BOT_URL","subtitle","buttons","actions","a","action","replace","payload","Error","renderMessenger","renderElements","image_url","attachment","template_type","renderElement","channel","module","exports","id","group","jsonSchema","description","required","properties","typingIndicators","computePreviewText","formData","length"],"mappings":"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","sourceRoot":"/var/lib/jenkins/workspace/build-linux/modules/builtin/src/backend","sourcesContent":["const base = require('./_base')\nconst Card = require('./card')\nconst url = require('url')\n\nfunction render(data) {\n  const events = []\n\n  if (data.typing) {\n    events.push({\n      type: 'typing',\n      value: data.typing\n    })\n  }\n\n  return [\n    ...events,\n    {\n      text: ' ',\n      type: 'carousel',\n      elements: data.items.map(card => ({\n        title: card.title,\n        picture: card.image ? url.resolve(data.BOT_URL, card.image) : null,\n        subtitle: card.subtitle,\n        buttons: (card.actions || []).map(a => {\n          if (a.action === 'Say something') {\n            return {\n              type: 'say_something',\n              title: a.title,\n              text: a.text\n            }\n          } else if (a.action === 'Open URL') {\n            return {\n              type: 'open_url',\n              title: a.title,\n              url: a.url && a.url.replace('BOT_URL', data.BOT_URL)\n            }\n          } else if (a.action === 'Postback') {\n            return {\n              type: 'postback',\n              title: a.title,\n              payload: a.payload\n            }\n          } else {\n            throw new Error(`Webchat carousel does not support \"${a.action}\" action-buttons at the moment`)\n          }\n        })\n      }))\n    }\n  ]\n}\n\nfunction renderMessenger(data) {\n  const renderElements = data => {\n    return data.items.map(card => ({\n      title: card.title,\n      image_url: card.image ? url.resolve(data.BOT_URL, card.image) : null,\n      subtitle: card.subtitle,\n      buttons: (card.actions || []).map(a => {\n        if (a.action === 'Say something') {\n          throw new Error('Channel-Messenger carousel does not support \"Say something\" action-buttons at the moment')\n        } else if (a.action === 'Open URL') {\n          return {\n            type: 'web_url',\n            url: a.url,\n            title: a.title\n          }\n        } else if (a.action === 'Postback') {\n          return {\n            type: 'postback',\n            title: a.title,\n            payload: a.payload\n          }\n        } else {\n          throw new Error(`Channel-Messenger carousel does not support \"${a.action}\" action-buttons at the moment`)\n        }\n      })\n    }))\n  }\n\n  const events = []\n\n  if (data.typing) {\n    events.push({\n      type: 'typing',\n      value: data.typing\n    })\n  }\n  \n  return [\n    ...events,\n    {\n      attachment: {\n        type: 'template',\n        payload: {\n          template_type: 'generic',\n          elements: renderElements(data)\n        }\n      }\n    }\n  ]\n}\n\nfunction renderElement(data, channel) {\n  if (channel === 'web' || channel === 'api' || channel === 'telegram') {\n    return render(data)\n  } else if (channel === 'messenger') {\n    return renderMessenger(data)\n  }\n\n  return [] // TODO Handle channel not supported\n}\n\nmodule.exports = {\n  id: 'builtin_carousel',\n  group: 'Built-in Messages',\n  title: 'Carousel',\n\n  jsonSchema: {\n    description: 'A carousel is an array of cards',\n    type: 'object',\n    required: ['items'],\n    properties: {\n      items: {\n        type: 'array',\n        title: 'Carousel Cards',\n        items: Card.jsonSchema\n      },\n      ...base.typingIndicators\n    }\n  },\n  computePreviewText: formData => formData.items && `Carousel: (${formData.items.length}) ${formData.items[0].title}`,\n  renderElement: renderElement\n}\n"]}